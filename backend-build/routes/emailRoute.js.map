{"version":3,"sources":["../../backend/routes/emailRoute.js"],"names":["nodemailer","require","router","express","Router","post","req","res","transporter","createTransport","host","config","EMAIL_HOST","port","EMAIL_PORT","auth","user","EMAIL_ACCOUNT_USER","pass","EMAIL_ACCOUNT_PASSWORD","tls","rejectUnauthorized","mailOptions","from","to","body","email","subject","attachments","filename","path","cid","html","name","sendMail","error","info","console","log","response","send","mysqlConnection","getConnection","err","connection","sql","query","result","fields","length","username","password","token","jwt","sign","JWT_SECRET","expiresIn","url","EMAIL_NEWSLETTER_USER","EMAIL_NEWSLETTER_PASSWORD","text","comments","EMAIL_CONTACT_USER","EMAIL_CONTACT_PASSWORD","message","orderId","beginTransaction","rollback","order","billingAddress","shippingAddress","queryProducts","products","map","x","temp","Object","assign","category","image","image_case","includes","emailTitle","htmltext","status","EMAIL_SALES_USER","EMAIL_SALES_PASSWORD","paymentType","user_email","companyName","subname","orderDate","toLocaleString","bussiness","street","paymentMethod","afm","city","district","postalCode","sendingMethod","doy","country","phoneNumber","quantity","totalPrice","itemsPrice","shippingPrice","paymentMethodPrice","commit","release","EMAIL_ORDER_USER","EMAIL_ORDER_PASSWORD"],"mappings":"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","sourcesContent":["const nodemailer = require('nodemailer');\r\nimport express from 'express';\r\nimport mysqlConnection from '../connection';\r\nimport jwt from 'jsonwebtoken';\r\nimport config from '../config';\r\n\r\nconst router= express.Router();\r\n\r\nrouter.post(\"/registerConfirmation\", (req, res)=>{\r\n    var transporter = nodemailer.createTransport({\r\n        host: config.EMAIL_HOST,\r\n        port: config.EMAIL_PORT,\r\n        auth: {\r\n          user: config.EMAIL_ACCOUNT_USER,\r\n          pass: config.EMAIL_ACCOUNT_PASSWORD\r\n        },\r\n        tls: {\r\n            rejectUnauthorized:false\r\n        }\r\n    });\r\n      \r\n    var mailOptions = {\r\n        from: config.EMAIL_ACCOUNT_USER,\r\n        to: req.body.email,\r\n        subject: 'Εγγραφή στο grandmobile.gr',\r\n        attachments: [{\r\n            filename: 'PNG_FINAL64.png',\r\n            path: 'frontend/public/PNG_FINAL64.png',\r\n            cid: 'logo' //same cid value as in the html img src\r\n        },{\r\n            filename: 'ΜΑΚΕΤΑ192.png',\r\n            path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n            cid: 'maketa' //same cid value as in the html img src,\r\n        \r\n        }],\r\n        html: '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>Grandmobile Accessories</h1>'+\r\n        '<p>Αγαπητέ/ή '+req.body.name+',<br/>'+\r\n        '<p>Ευχαριστούμε για την εγγραφής σας στο <a href=\"https://www.grandmobile.gr/\">grandmobile.gr</a> accessories. </p>'+\r\n        '<p>Για οποιαδήποτε απορία ή πρόβλημα, μη διστάσετε να επικοινωνήσετε μαζί μας, στο e-mail <strong>grandmobile@grandmobile.gr</strong> ή τηλεφωνικά στο <strong>22211 12505</strong>.</p>'+\r\n        '<img src=\"cid:maketa\"/>'\r\n    };\r\n    \r\n    transporter.sendMail(mailOptions, function(error, info){\r\n        if (error) {\r\n            console.log(error);\r\n        } else {\r\n            console.log('Email sent: ' + info.response);\r\n        }\r\n    });\r\n    res.send(\"Success Email Confirmation\")\r\n});\r\n\r\nrouter.post(\"/sendAccountDeleteConfirmation\", (req, res)=>{\r\n    var transporter = nodemailer.createTransport({\r\n        host: config.EMAIL_HOST,\r\n        port: config.EMAIL_PORT,\r\n        auth: {\r\n          user: config.EMAIL_ACCOUNT_USER,\r\n          pass: config.EMAIL_ACCOUNT_PASSWORD\r\n        },\r\n        tls: {\r\n            rejectUnauthorized:false\r\n        }\r\n    });\r\n      \r\n    var mailOptions = {\r\n        from: config.EMAIL_ACCOUNT_USER,\r\n        to: req.body.email,\r\n        subject: 'Διαγραφή λογαριασμού από το grandmobile.gr',\r\n        attachments: [{\r\n            filename: 'PNG_FINAL64.png',\r\n            path: 'frontend/public/PNG_FINAL64.png',\r\n            cid: 'logo' //same cid value as in the html img src\r\n        },{\r\n            filename: 'ΜΑΚΕΤΑ192.png',\r\n            path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n            cid: 'maketa' //same cid value as in the html img src,\r\n        \r\n        }],\r\n        html: '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>Grandmobile Accessories</h1>'+\r\n        '<p>Αγαπητέ/ή κύριε/α,<br/>'+\r\n        '<p>Η διαγραφή του λογαριασμού σας στο <a href=\"https://www.grandmobile.gr/\">grandmobile.gr</a> ολοκληρώθηκε επιτυχώς. </p>'+\r\n        '<p>Για οποιαδήποτε απορία ή πρόβλημα, μη διστάσετε να επικοινωνήσετε μαζί μας, στο e-mail <strong>grandmobile@grandmobile.gr</strong> ή τηλεφωνικά στο <strong>22211 12505</strong>.</p>'+\r\n        '<img src=\"cid:maketa\"/>'\r\n    };\r\n    \r\n    transporter.sendMail(mailOptions, function(error, info){\r\n        if (error) {\r\n            console.log(error);\r\n        } else {\r\n            console.log('Email sent: ' + info.response);\r\n        }\r\n    });\r\n    res.send(\"Success Email Confirmation\")\r\n});\r\n\r\nrouter.post(\"/resetpassword\", (req, res)=>{\r\n    \r\n    mysqlConnection.getConnection(function(err, connection) {\r\n        if (err) throw err; // not connected!\r\n        \r\n        var sql = \"SELECT username,email,password FROM users WHERE email=? LIMIT 1\";\r\n        connection.query(sql, [req.body.email],function (err, result, fields) {\r\n            if (err) throw err;\r\n\r\n            if(result.length!==0){\r\n                const user = {\r\n                    username: result[0].username,\r\n                    email: result[0].email,\r\n                    password: result[0].password\r\n                };\r\n\r\n                const token = jwt.sign({user},config.JWT_SECRET,{\r\n                    expiresIn:'1h'\r\n                });\r\n\r\n                let url=\"https://www.grandmobile.gr/password/reset/\"+req.body.email+'/'+token;\r\n\r\n                var transporter = nodemailer.createTransport({\r\n                    host: config.EMAIL_HOST,\r\n                    port: config.EMAIL_PORT,\r\n                    auth: {\r\n                      user: config.EMAIL_ACCOUNT_USER,\r\n                      pass: config.EMAIL_ACCOUNT_PASSWORD\r\n                    },\r\n                    tls: {\r\n                        rejectUnauthorized:false\r\n                    }\r\n                });\r\n                  \r\n                var mailOptions = {\r\n                    from: config.EMAIL_ACCOUNT_USER,\r\n                    to: req.body.email,\r\n                    subject: 'Επαναφορά Password',\r\n                    attachments: [{\r\n                        filename: 'PNG_FINAL64.png',\r\n                        path: 'frontend/public/PNG_FINAL64.png',\r\n                        cid: 'logo' //same cid value as in the html img src\r\n                    },{\r\n                        filename: 'ΜΑΚΕΤΑ192.png',\r\n                        path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n                        cid: 'maketa' //same cid value as in the html img src,\r\n                    \r\n                    }],\r\n                    html: '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>Grandmobile Accessories</h1>'+\r\n                    '<p>Αγαπητέ/ή '+result[0].username+',<br/>'+\r\n                    '<p>Για την επαναφορά του κωδικού σου πατήστε στο σύνδεσμο <br/> <a style=\"cursor:pointer\" href='+url+'>'+url+'</a> </p>'+\r\n                    '<p>Αν δεν χρησιμοποιήσετε το σύνδεσμο σε μία ώρα, αυτός θα λήξει.</p>'+\r\n                    '<img src=\"cid:maketa\"/>'\r\n                };\r\n                \r\n                transporter.sendMail(mailOptions, function(error, info){\r\n                    if (error) {\r\n                        console.log(error);\r\n                    } else {\r\n                        console.log('Email sent: ' + info.response);\r\n                    }\r\n                });\r\n                res.send(\"Success Email Confirmation\")\r\n            }\r\n            else\r\n            {\r\n                res.send(\"OK\");\r\n            }\r\n        })\r\n        // Handle error after the release.\r\n        if (err) throw err;\r\n    });\r\n    \r\n});\r\n\r\nrouter.post(\"/updatepassconfirmation\", (req, res)=>{\r\n    \r\n    mysqlConnection.getConnection(function(err, connection) {\r\n        if (err) throw err; // not connected!\r\n        \r\n        var sql = \"SELECT username FROM users WHERE email=? LIMIT 1\";\r\n        connection.query(sql, [req.body.email],function (err, result, fields) {\r\n            if (err) throw err;\r\n\r\n            if(result.length!==0){\r\n                \r\n                var transporter = nodemailer.createTransport({\r\n                    host: config.EMAIL_HOST,\r\n                    port: config.EMAIL_PORT,\r\n                    auth: {\r\n                      user: config.EMAIL_ACCOUNT_USER,\r\n                      pass: config.EMAIL_ACCOUNT_PASSWORD\r\n                    },\r\n                    tls: {\r\n                        rejectUnauthorized:false\r\n                    }\r\n                });\r\n                  \r\n                var mailOptions = {\r\n                    from: config.EMAIL_ACCOUNT_USER,\r\n                    to: req.body.email,\r\n                    subject: 'Επιτυχής Αλλαγή Κωδικού',\r\n                    attachments: [{\r\n                        filename: 'PNG_FINAL64.png',\r\n                        path: 'frontend/public/PNG_FINAL64.png',\r\n                        cid: 'logo' //same cid value as in the html img src\r\n                    },{\r\n                        filename: 'ΜΑΚΕΤΑ192.png',\r\n                        path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n                        cid: 'maketa' //same cid value as in the html img src,\r\n                    \r\n                    }],\r\n                    html: '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>Grandmobile Accessories</h1>'+\r\n                    '<p>Αγαπητέ/ή '+result[0].username+',<br/>'+\r\n                    '<p>Η επαναφορά του κωδικού σου έγινε επιτυχώς.</p>'+\r\n                    '<p></p>'+\r\n                    '<img src=\"cid:maketa\"/>'\r\n                };\r\n                \r\n                transporter.sendMail(mailOptions, function(error, info){\r\n                    if (error) {\r\n                        console.log(error);\r\n                    } else {\r\n                        console.log('Email sent: ' + info.response);\r\n                    }\r\n                });\r\n                res.send(\"Success Email Confirmation\")\r\n            }\r\n            else\r\n            {\r\n                res.send(\"OK\");\r\n            }\r\n        })\r\n        // Handle error after the release.\r\n        if (err) throw err;\r\n    });\r\n    \r\n});\r\n\r\nrouter.post(\"/addToNewsletters\", (req, res)=>{\r\n    var transporter = nodemailer.createTransport({\r\n        host: config.EMAIL_HOST,\r\n        port: config.EMAIL_PORT,\r\n        auth: {\r\n          user: config.EMAIL_NEWSLETTER_USER ,\r\n          pass: config.EMAIL_NEWSLETTER_PASSWORD\r\n        },\r\n        tls: {\r\n            rejectUnauthorized:false\r\n        }\r\n    });\r\n      \r\n    var mailOptions = {\r\n        from: config.EMAIL_NEWSLETTER_USER,\r\n        to: req.body.email,\r\n        subject: 'Επιβεβαίωση Εγγραφής Στο Newsletter',\r\n        attachments: [{\r\n            filename: 'PNG_FINAL64.png',\r\n            path: 'frontend/public/PNG_FINAL64.png',\r\n            cid: 'logo' //same cid value as in the html img src\r\n        },{\r\n            filename: 'ΜΑΚΕΤΑ192.png',\r\n            path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n            cid: 'maketa' //same cid value as in the html img src,\r\n        \r\n        }],\r\n        html: '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>Grandmobile Accessories</h1>'+\r\n        '<p>Ευχαριστούμε για την εγγραφής σας στο newsletter του Grandmobile accessories. </p>'+\r\n        '<p>Για οποιαδήποτε απορία ή πρόβλημα, μη διστάσετε να επικοινωνήσετε μαζί μας, στο e-mail <strong>grandmobile@grandmobile.gr</strong> ή τηλεφωνικά στο <strong>22211 12505</strong>.</p>'+\r\n        '<img src=\"cid:maketa\"/>'\r\n    };\r\n    \r\n    transporter.sendMail(mailOptions, function(error, info){\r\n        if (error) {\r\n            console.log(error);\r\n        } else {\r\n            console.log('Email sent: ' + info.response);\r\n        }\r\n    });\r\n    res.send(\"Success Newsletter Confirmation\")\r\n});\r\n\r\nrouter.post(\"/removeFromNewsletters\", (req, res)=>{\r\n    // email στον πελάτη\r\n    var transporter = nodemailer.createTransport({\r\n        host: config.EMAIL_HOST,\r\n        port: config.EMAIL_PORT,\r\n        auth: {\r\n          user: config.EMAIL_NEWSLETTER_USER,\r\n          pass: config.EMAIL_NEWSLETTER_PASSWORD\r\n        },\r\n        tls: {\r\n            rejectUnauthorized:false\r\n        }\r\n    });\r\n      \r\n    var mailOptions = {\r\n        from: config.EMAIL_NEWSLETTER_USER,\r\n        to: req.body.email,\r\n        subject: 'Επιβεβαίωση Διαγραφής Από Newsletter',\r\n        attachments: [{\r\n            filename: 'PNG_FINAL64.png',\r\n            path: 'frontend/public/PNG_FINAL64.png',\r\n            cid: 'logo' //same cid value as in the html img src\r\n        },{\r\n            filename: 'ΜΑΚΕΤΑ192.png',\r\n            path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n            cid: 'maketa' //same cid value as in the html img src,\r\n        }],\r\n        html: '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>Grandmobile Accessories</h1>'+\r\n        '<p>Το email σας έχει διαγραφεί επιτυχώς από τις λίστες μας</p>'+\r\n        '<p>Για οποιαδήποτε απορία ή πρόβλημα, μη διστάσετε να επικοινωνήσετε μαζί μας, στο e-mail <strong>grandmobile@grandmobile.gr</strong> ή τηλεφωνικά στο <strong>22211 12505</strong>.</p>'+\r\n        '<img src=\"cid:maketa\"/>'\r\n    };\r\n    \r\n    transporter.sendMail(mailOptions, function(error, info){\r\n        if (error) {\r\n            console.log(error);\r\n        } else {\r\n            console.log('Email sent: ' + info.response);\r\n        }\r\n    });\r\n\r\n    // εμαιλ στο κατάστημα για τυχών σχόλια του πελάτη\r\n    transporter = nodemailer.createTransport({\r\n        host: config.EMAIL_HOST,\r\n        port: config.EMAIL_PORT,\r\n        auth: {\r\n          user: config.EMAIL_NEWSLETTER_USER,\r\n          pass: config.EMAIL_NEWSLETTER_PASSWORD\r\n        },\r\n        tls: {\r\n            rejectUnauthorized:false\r\n        }\r\n    });\r\n      \r\n    mailOptions = {\r\n        from: config.EMAIL_NEWSLETTER_USER,\r\n        to: config.EMAIL_NEWSLETTER_USER,\r\n        subject: 'Επιβεβαίωση Διαγραφής Από Newsletter',\r\n        text: 'Email:'+ req.body.email+ '\\n'+\r\n        'Σχόλια:' + req.body.comments,\r\n    };\r\n    \r\n    transporter.sendMail(mailOptions, function(error, info){\r\n        if (error) {\r\n            console.log(error);\r\n        } else {\r\n            console.log('Email sent: ' + info.response);\r\n        }\r\n    });\r\n    res.send(\"Success Newsletter Deleting\")\r\n});\r\n\r\nrouter.post(\"/toContact\", (req, res)=>{\r\n    var transporter = nodemailer.createTransport({\r\n        host: config.EMAIL_HOST,\r\n        port: config.EMAIL_PORT,\r\n        auth: {\r\n          user: config.EMAIL_CONTACT_USER,\r\n          pass: config.EMAIL_CONTACT_PASSWORD\r\n        },\r\n        tls: {\r\n            rejectUnauthorized:false\r\n        }\r\n    });\r\n      \r\n    var mailOptions = {\r\n        from: config.EMAIL_CONTACT_USER,\r\n        to: config.EMAIL_CONTACT_USER,\r\n        subject: req.body.subject,\r\n        html: '<p>Ονοματεπώνυμο: '+ req.body.name+'</p>'+\r\n        '<p>email: '+req.body.email+'</p>'+\r\n        '<p>Μήνυμα: '+req.body.message+'</p>'\r\n    };\r\n    \r\n    transporter.sendMail(mailOptions, function(error, info){\r\n        if (error) {\r\n            console.log(error);\r\n        } else {\r\n            console.log('Email sent: ' + info.response);\r\n        }\r\n    });\r\n    res.send(\"Success Email to Contacts\")\r\n});\r\n\r\nrouter.post(\"/orderConfimation\", (req, res)=>{\r\n    const orderId = req.body.orderId;\r\n    mysqlConnection.getConnection(function(err, connection) {\r\n        if (err) throw err; // not connected!\r\n        /* Begin transaction */\r\n        connection.beginTransaction(function(err) {\r\n            if (err) { throw err; }\r\n\r\n            let sql = \"SELECT * FROM orders WHERE order_id=?\";\r\n            connection.query(sql, [orderId], function(err, result) {\r\n            if (err) { \r\n                connection.rollback(function() {\r\n                throw err;\r\n                });\r\n            }\r\n        \r\n            const order = result[0];\r\n        \r\n            sql = \"SELECT addresses.* FROM addresses INNER JOIN orders ON addresses.address_id = orders.billingAddress WHERE orders.order_id=?\";\r\n            connection.query(sql, [orderId], function(err, result) {\r\n                if (err) { \r\n                connection.rollback(function() {\r\n                    throw err;\r\n                });\r\n                }\r\n\r\n                var billingAddress = result[0];\r\n                \r\n                sql = \"SELECT addresses.* FROM addresses INNER JOIN orders ON addresses.address_id = orders.shippingAddress WHERE orders.order_id=?\";\r\n                connection.query(sql, [orderId], function(err, result) {\r\n                    if (err) { \r\n                    connection.rollback(function() {\r\n                        throw err;\r\n                    });\r\n                    }\r\n\r\n                    var shippingAddress = result[0];\r\n\r\n                    sql = \"SELECT products._id, products.name, products.image, products.category, products.totalPrice, products.countInStock, order_products.quantity, order_products.model, order_products.image_case FROM products INNER JOIN order_products ON products._id = order_products.product_id WHERE order_products.order_id=?\";\r\n                    connection.query(sql, [orderId], function(err, result) {\r\n                        if (err) { \r\n                        connection.rollback(function() {\r\n                            throw err;\r\n                        });\r\n                        }\r\n\r\n                        var queryProducts = result;\r\n\r\n                        var products=queryProducts.map(x=>{\r\n                            var temp = Object.assign({}, x);\r\n                            if(temp.category===\"Φτιάξε τη Θήκη σου\")\r\n                            {\r\n                                temp.image=\"https://grandmobile.gr/images/makeyourcase/\"+temp.image_case;\r\n                            }\r\n                            else if(!temp.image.includes(\"http\"))\r\n                            {\r\n                                temp.image=\"https://grandmobile.gr/images/products/\"+temp.image;\r\n                            }\r\n                            return temp\r\n                        });\r\n\r\n                        var response = {\r\n                            order,\r\n                            billingAddress,\r\n                            shippingAddress,\r\n                            products\r\n                        };\r\n\r\n                        var emailTitle=''\r\n                        var htmltext='';\r\n                        \r\n                        switch (response.order.status) {\r\n                            case 'Καταχωρήθηκε':\r\n                                emailTitle='Επιβεβαίωση Παραγγελίας #'+orderId;\r\n                                htmltext= 'Έχουμε <strong>παραλάβει</strong> την παραγγελία σας και αναμένεται να επεξεργαστεί από άνθρωπο μας. Θα ενημερωθείτε <strong>άμεσα</strong> όταν επεξεργαστεί με νέο μήνυμα. Μείνετε συντονισμένοι!';\r\n                                break;\r\n                            case 'Επεξεργάζεται':\r\n                                emailTitle='Η Παραγγελία #'+orderId+ ' επεξεργάζεται';\r\n                                htmltext= '<strong>Επεξεργαζόμαστε</strong> την παραγγελία σας και συσκευάζουμε προσεκτικά τα προϊόντα σας. Θα ενημερωθείτε <strong>άμεσα</strong> όταν ολοκληρωθεί η διαδικασία με νέο μήνυμα. Μείνετε συντονισμένοι!';\r\n                                break;\r\n                            case 'Αναμονή':\r\n                                emailTitle='Η Παραγγελία #'+orderId+ ' βρίσκετε σε αναμονή';\r\n                                htmltext= 'Κάποιο ή κάποια από τα προϊόντα σας <strong>δεν είναι άμεσα διαθέσιμα</strong> .Θα ενημερωθείτε <strong>άμεσα</strong> όταν ολοκληρωθεί η διαδικασία με νέο μήνυμα. Μείνετε συντονισμένοι!';\r\n                                break;\r\n                            case 'Ολοκληρώθηκε':\r\n                                emailTitle='Η Παραγγελία #'+orderId+ ' ολοκληρώθηκε';\r\n                                htmltext= 'Η παραγγελία σας έχει <strong>ολοκληρωθεί</strong> και  έχει εκδοθεί το κατάλληλο παραστατικό.Ευχαριστούμε για την προτίμησή σας!';\r\n                               break; \r\n                            case 'Ακυρώθηκε':\r\n                                emailTitle='Η Παραγγελία #'+orderId+ ' ακυρώθηκε';\r\n                                htmltext= 'Η παραγγελία σας έχει <strong>ακυρωθεί</strong>.';\r\n                               break;                           \r\n                            default:\r\n                                break;\r\n                        }\r\n\r\n                        var transporter = nodemailer.createTransport({\r\n                            host: config.EMAIL_HOST,\r\n                            port: config.EMAIL_PORT,\r\n                            auth: {\r\n                              user: config.EMAIL_SALES_USER,\r\n                              pass: config.EMAIL_SALES_PASSWORD\r\n                            },\r\n                            tls: {\r\n                                rejectUnauthorized:false\r\n                            }\r\n                        });\r\n\r\n                        if(order.paymentType===\"Τιμολόγιο\")\r\n                        {\r\n                            if(response.shippingAddress)\r\n                            {\r\n                                var mailOptions = {\r\n                                    from: config.EMAIL_SALES_USER,\r\n                                    to: response.billingAddress.user_email,\r\n                                    subject: emailTitle,\r\n                                    attachments: [{\r\n                                        filename: 'PNG_FINAL64.png',\r\n                                        path: 'frontend/public/PNG_FINAL64.png',\r\n                                        cid: 'logo' //same cid value as in the html img src,\r\n                                    },{\r\n                                        filename: 'ΜΑΚΕΤΑ192.png',\r\n                                        path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n                                        cid: 'maketa' //same cid value as in the html img src,\r\n                                    \r\n                                    }],\r\n                                    html:'<h1 style=\"color: #312f8b\">Grandmobile accessories</h1> '+\r\n                                    '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>'+\r\n                                    'Η παραγγελία με αριθμό #'+orderId+' '+response.order.status+' </h1>'+\r\n                                    '<p>Αγαπητέ/ή '+response.billingAddress.name+',<br/>'+\r\n                                    'Η κατάσταση της παραγγελίας σας έχει αλλάξει σε '+response.order.status+'.<br/>'\r\n                                    +htmltext+                                    \r\n                                    '<br/><hr/>'+\r\n                                    '<div style=\"border-top:1px solid #312f8b;\">'+                                        \r\n                                        '<table style=\"width:100%;\">'+\r\n                                            '<colgroup>'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                            '</colgroup>'+\r\n                                            '<tr><th>ΣΤΟΙΧΕΙΑ ΤΙΜΟΛΟΓΗΣΗΣ</th><th>ΠΑΡΑΔΟΣΗ</th><th>ΗΜΕΡΟΜΗΝΙΑ ΠΑΡΑΓΓΕΛΙΑΣ</th></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.companyName+'</td><td>'+response.shippingAddress.name+' '+response.shippingAddress.subname+'</td><td>'+response.order.orderDate.toLocaleString() +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.bussiness+'</td><td>'+response.shippingAddress.street+'</td><td>ΠΛΗΡΩΜΗ: '+response.order.paymentMethod +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.afm+'</td><td>'+response.shippingAddress.city+','+response.shippingAddress.district+','+response.shippingAddress.postalCode+'</td><td>ΜΕΤΑΦΟΡΙΚΑ: '+response.order.sendingMethod +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.doy+'</td><td>'+response.shippingAddress.country+'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.street+'</td><td></td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.city+','+response.billingAddress.district+','+response.billingAddress.postalCode+'</td><td></td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.country+'</td><td></td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.phoneNumber+'</td><td></td></tr>'+\r\n                                        '<table/>'+                                   \r\n                                    '</div><hr/>'+\r\n                                    '<table style=\"width:100%;\">'+\r\n                                        '<colgroup>'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 50%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                        '</colgroup>'+\r\n                                        '<tr>'+\r\n                                            '<th>Φώτο</th>'+\r\n                                            '<th>Προιόν</th>'+\r\n                                            '<th>Ποσότητα</th>'+\r\n                                            '<th>Τιμή</th>'+\r\n                                            '<th>Σύνολο Προιόντος</th>'+\r\n                                        '</tr>'+\r\n                                        response.products.map(x=>\r\n                                        '<tr>'+\r\n                                        '<td><img style=\"width:30px; height:30px\" src='+x.image+'><img></td>'+\r\n                                        '<td>'+x.name+'</td>'+\r\n                                        '<td>'+x.quantity+'</td>'+\r\n                                        '<td>'+x.totalPrice+' €</td>'+\r\n                                        '<td>'+x.quantity*x.totalPrice+' €</td>'+\r\n                                        '</tr>')+\r\n                                        '<table/><hr/>'+\r\n                                        '<table style=\"width:100%;\">'+\r\n                                            '<colgroup>'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                            '</colgroup>'+\r\n                                            '<tr><th>ΣΗΜΕΙΩΣΕΙΣ ΠΕΛΑΤΗ</th><th>     </th></tr>'+\r\n                                            '<tr><td>'+response.order.comments+'</td><td>     </td><td>Υποσύνολο: '+response.order.itemsPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td>ΜΕΤΑΦΟΡΙΚΑ: '+response.order.shippingPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td>ΧΡΕΩΣΗ ΑΝΤΙΚΑΤΑΒΟΛΗΣ: '+response.order.paymentMethodPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td><strong>Σύνολο: </strong>'+response.order.totalPrice +'</td></tr>'+\r\n                                            '<tr><td></td><td>  <img src=\"cid:maketa\"/>   </td></tr>'+                                    \r\n                                        '<table/>'\r\n                                };\r\n                            }\r\n                            else\r\n                            {\r\n                                var mailOptions = {\r\n                                    from: config.EMAIL_SALES_USER,\r\n                                    to: response.billingAddress.user_email,\r\n                                    subject: emailTitle,\r\n                                    attachments: [{\r\n                                        filename: 'PNG_FINAL64.png',\r\n                                        path: 'frontend/public/PNG_FINAL64.png',\r\n                                        cid: 'logo' //same cid value as in the html img src,\r\n                                    },{\r\n                                        filename: 'ΜΑΚΕΤΑ192.png',\r\n                                        path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n                                        cid: 'maketa' //same cid value as in the html img src,\r\n                                    \r\n                                    }],\r\n                                    html:'<h1 style=\"color: #312f8b\">Grandmobile accessories</h1> '+\r\n                                    '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>'+\r\n                                    'Η παραγγελία με αριθμό #'+orderId+' '+response.order.status+' </h1>'+\r\n                                    '<p>Αγαπητέ/ή '+response.billingAddress.name+',<br/>'+\r\n                                    'Η κατάσταση της παραγγελίας σας έχει αλλάξει σε '+response.order.status+'.<br/>'\r\n                                    +htmltext+\r\n                                    '<br/><hr/>'+\r\n                                    '<div>'+\r\n                                        '<table style=\"width:100%;\">'+\r\n                                            '<colgroup>'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                            '</colgroup>'+\r\n                                            '<tr><th>ΣΤΟΙΧΕΙΑ ΤΙΜΟΛΟΓΗΣΗΣ</th><th></th><th>ΗΜΕΡΟΜΗΝΙΑ ΠΑΡΑΓΓΕΛΙΑΣ</th></tr>'+\r\n                                            '<tr><td>'+'ΕΠΩΝΥΜΙΑ: '+response.billingAddress.companyName+'</td><td>      </td><td>'+response.order.orderDate.toLocaleString() +'</td></tr>'+\r\n                                            '<tr><td>'+'Επάγγελμα: '+response.billingAddress.bussiness+'</td><td>        </td><td>ΠΛΗΡΩΜΗ: '+response.order.paymentMethod +'</td></tr>'+\r\n                                            '<tr><td>'+'Α.Φ.Μ.: '+response.billingAddress.afm+'</td><td>      </td><td>ΜΕΤΑΦΟΡΙΚΑ: '+response.order.sendingMethod +'</td></tr>'+\r\n                                            '<tr><td>'+'Δ.Ο.Υ.: '+response.billingAddress.doy+'</td><td>       </td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.street+'</td><td></td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.city+','+response.billingAddress.district+','+response.billingAddress.postalCode+'</td><td></td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.country+'</td><td></td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.phoneNumber+'</td><td></td></tr>'+                                    \r\n                                        '<table/>'+                                   \r\n                                    '</div><hr/>'+\r\n                                    '<table style=\"width:100%;\">'+\r\n                                        '<colgroup>'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 50%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                        '</colgroup>'+\r\n                                        '<tr>'+\r\n                                            '<th>Φώτο</th>'+\r\n                                            '<th>Προιόν</th>'+\r\n                                            '<th>Ποσότητα</th>'+\r\n                                            '<th>Τιμή</th>'+\r\n                                            '<th>Σύνολο Προιόντος</th>'+\r\n                                        '</tr>'+\r\n                                        response.products.map(x=>\r\n                                        '<tr>'+\r\n                                        '<td><img style=\"width:30px; height:30px\" src='+x.image+'><img></td>'+\r\n                                        '<td>'+x.name+'</td>'+\r\n                                        '<td>'+x.quantity+'</td>'+\r\n                                        '<td>'+x.totalPrice+' €</td>'+\r\n                                        '<td>'+x.quantity*x.totalPrice+' €</td>'+\r\n                                        '</tr>')+\r\n                                        '<table/><hr/>'+\r\n                                        '<table style=\"width:100%;\">'+\r\n                                            '<colgroup>'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                            '</colgroup>'+\r\n                                            '<tr><th>ΣΗΜΕΙΩΣΕΙΣ ΠΕΛΑΤΗ</th><th>     </th></tr>'+\r\n                                            '<tr><td>'+response.order.comments+'</td><td>     </td><td>Υποσύνολο: '+response.order.itemsPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td>ΜΕΤΑΦΟΡΙΚΑ: '+response.order.shippingPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td>ΧΡΕΩΣΗ ΑΝΤΙΚΑΤΑΒΟΛΗΣ: '+response.order.paymentMethodPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td><strong>Σύνολο: </strong>'+response.order.totalPrice +'</td></tr>'+\r\n                                            '<tr><td></td><td>  <img src=\"cid:maketa\"/>   </td></tr>'+                                    \r\n                                        '<table/>'\r\n                                };\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            if(response.shippingAddress)\r\n                            {\r\n                                var mailOptions = {\r\n                                    from: config.EMAIL_SALES_USER,\r\n                                    to: response.billingAddress.user_email,\r\n                                    subject: emailTitle,\r\n                                    attachments: [{\r\n                                        filename: 'PNG_FINAL64.png',\r\n                                        path: 'frontend/public/PNG_FINAL64.png',\r\n                                        cid: 'logo' //same cid value as in the html img src,\r\n                                    },{\r\n                                        filename: 'ΜΑΚΕΤΑ192.png',\r\n                                        path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n                                        cid: 'maketa' //same cid value as in the html img src,\r\n                                    \r\n                                    }],\r\n                                    html:'<h1 style=\"color: #312f8b\">Grandmobile accessories</h1> '+\r\n                                    '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>'+\r\n                                    'Η παραγγελία με αριθμό #'+orderId+' '+response.order.status+' </h1>'+\r\n                                    '<p>Αγαπητέ/ή '+response.billingAddress.name+',<br/>'+\r\n                                    'Η κατάσταση της παραγγελίας σας έχει αλλάξει σε '+response.order.status+'.<br/>'\r\n                                    +htmltext+\r\n                                    '<br/><hr/>'+\r\n                                    '<div style=\"border-top:1px solid #312f8b;\">'+\r\n                                        '<table style=\"width:100%;\">'+\r\n                                            '<colgroup>'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                            '</colgroup>'+\r\n                                            '<tr><th>ΠΕΛΑΤΗΣ</th><th>ΠΑΡΑΔΟΣΗ</th><th>ΗΜΕΡΟΜΗΝΙΑ ΠΑΡΑΓΓΕΛΙΑΣ</th></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.name+' '+response.billingAddress.subname+'</td><td>'+response.shippingAddress.name+' '+response.shippingAddress.subname+'</td><td>'+response.order.orderDate.toLocaleString() +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.street+'</td><td>'+response.shippingAddress.street+'</td><td>ΠΛΗΡΩΜΗ: '+response.order.paymentMethod +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.city+','+response.billingAddress.district+','+response.billingAddress.postalCode+'</td><td>'+response.shippingAddress.city+','+response.shippingAddress.district+','+response.shippingAddress.postalCode+'</td><td>ΜΕΤΑΦΟΡΙΚΑ: '+response.order.sendingMethod +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.country+'</td><td>'+response.shippingAddress.country+'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.phoneNumber+'</td><td></td></tr>'+                                    \r\n                                        '<table/>'+                                   \r\n                                    '</div><hr/>'+\r\n                                    '<table style=\"width:100%;\">'+\r\n                                        '<colgroup>'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 50%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                        '</colgroup>'+\r\n                                        '<tr\">'+\r\n                                            '<th>Φώτο</th>'+\r\n                                            '<th>Προιόν</th>'+\r\n                                            '<th>Ποσότητα</th>'+\r\n                                            '<th>Τιμή</th>'+\r\n                                            '<th>Σύνολο Προιόντος</th>'+\r\n                                        '</tr>'+\r\n                                        response.products.map(x=>\r\n                                        '<tr>'+\r\n                                        '<td><img style=\"width:30px; height:30px\" src='+x.image+'><img></td>'+\r\n                                        '<td>'+x.name+'</td>'+\r\n                                        '<td>'+x.quantity+'</td>'+\r\n                                        '<td>'+x.totalPrice+' €</td>'+\r\n                                        '<td>'+x.quantity*x.totalPrice+' €</td>'+\r\n                                        '</tr>')+\r\n                                        '<table/><hr/>'+\r\n                                        '<table style=\"width:100%;\">'+\r\n                                            '<colgroup>'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                            '</colgroup>'+\r\n                                            '<tr><th>ΣΗΜΕΙΩΣΕΙΣ ΠΕΛΑΤΗ</th><th>     </th></tr>'+\r\n                                            '<tr><td>'+response.order.comments+'</td><td>     </td><td>Υποσύνολο: '+response.order.itemsPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td>ΜΕΤΑΦΟΡΙΚΑ: '+response.order.shippingPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td>ΧΡΕΩΣΗ ΑΝΤΙΚΑΤΑΒΟΛΗΣ: '+response.order.paymentMethodPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td><strong>Σύνολο: </strong>'+response.order.totalPrice +'</td></tr>'+\r\n                                            '<tr><td></td><td>  <img src=\"cid:maketa\"/>   </td></tr>'+                                    \r\n                                        '<table/>'\r\n                                };\r\n                            }\r\n                            else\r\n                            {\r\n                                var mailOptions = {\r\n                                    from: config.EMAIL_SALES_USER,\r\n                                    to: response.billingAddress.user_email,\r\n                                    subject: emailTitle,\r\n                                    attachments: [{\r\n                                        filename: 'PNG_FINAL64.png',\r\n                                        path: 'frontend/public/PNG_FINAL64.png',\r\n                                        cid: 'logo' //same cid value as in the html img src,\r\n                                    },{\r\n                                        filename: 'ΜΑΚΕΤΑ192.png',\r\n                                        path: 'frontend/public/ΜΑΚΕΤΑ192.png',\r\n                                        cid: 'maketa' //same cid value as in the html img src,\r\n                                    \r\n                                    }],\r\n                                    html:'<h1 style=\"color: #312f8b\">Grandmobile accessories</h1> '+\r\n                                    '<h1 style=\"background-color:#4b4a9c;color:white;text-align:center;padding:1rem;\"><img src=\"cid:logo\"/>'+\r\n                                    'Η παραγγελία με αριθμό #'+orderId+' '+response.order.status+' </h1>'+\r\n                                    '<p>Αγαπητέ/ή '+response.billingAddress.name+',<br/>'+\r\n                                    'Η κατάσταση της παραγγελίας σας έχει αλλάξει σε '+response.order.status+'.<br/>'\r\n                                    +htmltext+\r\n                                    '<br/><hr/>'+\r\n                                    '<div>'+\r\n                                        '<table style=\"width:100%;\">'+\r\n                                            '<colgroup>'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                            '</colgroup>'+\r\n                                            '<tr><th>ΑΠΟΣΤΟΛΗ</th><th></th><th>ΗΜΕΡΟΜΗΝΙΑ ΠΑΡΑΓΓΕΛΙΑΣ</th></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.name+' '+response.billingAddress.subname+'</td><td>      </td><td>'+response.order.orderDate.toLocaleString() +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.street+'</td><td>        </td><td>ΠΛΗΡΩΜΗ: '+response.order.paymentMethod +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.city+','+response.billingAddress.district+','+response.billingAddress.postalCode+'</td><td>      </td><td>ΜΕΤΑΦΟΡΙΚΑ: '+response.order.sendingMethod +'</td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.country+'</td><td>       </td></tr>'+\r\n                                            '<tr><td>'+response.billingAddress.phoneNumber+'</td><td></td></tr>'+                                    \r\n                                        '<table/>'+                                   \r\n                                    '</div><hr/>'+\r\n                                    '<table style=\"width:100%;\">'+\r\n                                        '<colgroup>'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 50%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                            '<col span=\"1\" style=\"width: 10%;\">'+\r\n                                        '</colgroup>'+\r\n                                        '<tr'+\r\n                                            '<th>Φώτο</th>'+\r\n                                            '<th>Προιόν</th>'+\r\n                                            '<th>Ποσότητα</th>'+\r\n                                            '<th>Τιμή</th>'+\r\n                                            '<th>Σύνολο Προιόντος</th>'+\r\n                                        '</tr>'+\r\n                                        response.products.map(x=>\r\n                                        '<tr>'+\r\n                                        '<td><img style=\"width:30px; height:30px\" src='+x.image+'></img></td>'+\r\n                                        '<td>'+x.name+'</td>'+\r\n                                        '<td>'+x.quantity+'</td>'+\r\n                                        '<td>'+x.totalPrice+' €</td>'+\r\n                                        '<td>'+x.quantity*x.totalPrice+' €</td>'+\r\n                                        '</tr>')+\r\n                                        '<table/><hr/>'+\r\n                                        '<table style=\"width:100%;\">'+\r\n                                            '<colgroup>'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                                '<col span=\"1\" style=\"width: 33%;\">'+\r\n                                            '</colgroup>'+\r\n                                            '<tr><th>ΣΗΜΕΙΩΣΕΙΣ ΠΕΛΑΤΗ</th><th>     </th></tr>'+\r\n                                            '<tr><td>'+response.order.comments+'</td><td>     </td><td>Υποσύνολο: '+response.order.itemsPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td>ΜΕΤΑΦΟΡΙΚΑ: '+response.order.shippingPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td>ΧΡΕΩΣΗ ΑΝΤΙΚΑΤΑΒΟΛΗΣ: '+response.order.paymentMethodPrice +' €</td></tr>'+\r\n                                            '<tr><td></td><td>     </td><td><strong>Σύνολο: </strong>'+response.order.totalPrice +'</td></tr>'+\r\n                                            '<tr><td></td><td>  <img src=\"cid:maketa\"/>   </td></tr>'+                                    \r\n                                        '<table/>'\r\n                                };\r\n                            }\r\n                        }\r\n                        \r\n                        transporter.sendMail(mailOptions, function(error, info){\r\n                            if (error) {\r\n                                console.log(error);\r\n                            } else {\r\n                                console.log('Email sent: ' + info.response);\r\n                            }\r\n                        });\r\n                        res.send(\"Success Email to Contacts\")\r\n\r\n\r\n                        connection.commit(function(err) {\r\n                        if (err) { \r\n                            connection.rollback(function() {\r\n                            throw err;\r\n                            });\r\n                        }\r\n                        console.log('Transaction Completed Successfully.');\r\n                        connection.release();\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n            });\r\n        });\r\n        /* End transaction */\r\n\r\n        // Handle error after the release.\r\n        if (err) throw err;\r\n    });\r\n    \r\n});\r\n\r\nrouter.post(\"/sendNewOrderNotification\", (req, res)=>{\r\n    var transporter = nodemailer.createTransport({\r\n        host: config.EMAIL_HOST,\r\n        port: config.EMAIL_PORT,\r\n        auth: {\r\n          user: config.EMAIL_ORDER_USER,\r\n          pass: config.EMAIL_ORDER_PASSWORD\r\n        },\r\n        tls: {\r\n            rejectUnauthorized:false\r\n        }\r\n    });\r\n      \r\n    var mailOptions = {\r\n        from: config.EMAIL_ORDER_USER,\r\n        to: config.EMAIL_ORDER_USER,\r\n        subject: 'Νέα παραγγελία. Κωδικός: '+ req.body.orderId,\r\n        html: '<p>Μόλις λάβατε μια νέα παραγγελία με κωδικό '+ req.body.orderId+'</p>'\r\n    };\r\n    \r\n    transporter.sendMail(mailOptions, function(error, info){\r\n        if (error) {\r\n            console.log(error);\r\n        } else {\r\n            console.log('Email sent: ' + info.response);\r\n        }\r\n    });\r\n    res.send(\"Success Email to Order Notification\")\r\n});\r\n\r\n\r\nexport default router;"],"file":"emailRoute.js"}